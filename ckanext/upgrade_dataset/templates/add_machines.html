{% extends "package/new_resource.html" %}
{% import 'macros/form.html' as input_object %}

{% block styles %}
  {{ super() }}
  {% asset 'ckanext-upgrade-dataset/machines-css' %}
{% endblock styles %} 

{% block breadcrumb_content %}
  {{ super() }}
  {% if pkg %}
    <li class="active"><a href="#">{{ _('Add Machines') }}</a></li>
  {% endif %}
{% endblock %}

{% block form %}
  {% block stages %}        
      {% if custom_stage %}
          {{ h.snippet('package/snippets/stages.html', stages=custom_stage, pkg_name=pkg_dict['name']) }}
      {% endif %}
  {% endblock %}

  {% set action = h.url_for('media_wiki.save_machines', _external=True) %}
  <form id="machine-form" class="" method="post" action='{{action}}' data-module="basic-form" enctype="multipart/form-data">
      <h3>{{_('Please Select the machine(s) for this dataset')}}:</h3>
      <input type="hidden" name="package"  value="{{pkg_dict['name']}}">
      
      <table>
        <tr>
          <th>{{_('Resource')}}</th>
          <th>{{_('Machine')}}</th>
        </tr>    
        {% for res in pkg_dict['resources'] %}          
          <tr>
            <td>{{res.name}}</td>
            <td>
              {{ input_object.select('machine_link' ~ loop.index, 
                  id='machines_dropdown' ~ loop.index,                  
                  options=machines_list, selected='', classes=[], attrs={'class': 'form-control machine_dropdown'}, is_required=false) 
              }}
              {{
                input_object.checkbox('notFind' ~ loop.index, id='not_find' ~ loop.index, 
                  label= _('Machine is not listed'), 
                  value='', checked=false, placeholder='', error="", classes=[], attrs={'class': 'notFindCheckBox'}, is_required=false)
              }}
              <div id= {{ 'manual_link_box' ~ loop.index }} class="manUrl">
                  {{
                    input_object.input('machine_link_manually' ~ loop.index, 
                      id='machine_manual_link' ~ loop.index, 
                      label= _('URL for the target machine'), 
                      value='', placeholder= _('Ex: https://service.tib.eu/sfb1368/wiki/machinePage'),
                      type='text', error="", classes=[], attrs={'class': 'form-control'}, is_required=false)
                  }}
              </div>
            </td>
          </tr>  
        {% endfor %}
      </table>
      <br><br>
      <div class="form-actions">
        <button class="btn btn-default" name="save_btn" value="go-dataset-veiw" type="submit">{{ _('I add it later') }}</button>
        <button class="btn btn-primary" name="save_btn" value="finish_machine" type="submit">{{ _('Add') }}</button>
      </div>      
      
  </form>

{% endblock %}

{% block scripts %}
  {{ super() }}
  {% asset 'ckanext-upgrade-dataset/machines-js' %}
{% endblock %}